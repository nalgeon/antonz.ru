+++
date = 2021-05-13T14:06:22Z
description = "ะกะบะพะปัะทััะตะต ััะตะดะฝะตะต ะธ ะบัะผัะปััะธะฒะฝะฐั ััะผะผะฐ."
image = "/window-rolling/cover.png"
slug = "window-rolling"
tags = ["data", "sqlite"]
title = "ะะบะพะฝะฝัะต ััะฝะบัะธะธ: ัะบะพะปัะทััะธะต ะฐะณัะตะณะฐัั"
+++

_ะญัะพ ะฟััะฐั, ะทะฐะบะปััะธัะตะปัะฝะฐั ััะฐััั ะธะทยัะตัะธะธ [ะะบะพะฝะฝัะต ััะฝะบัะธะธ ะฒยะบะฐััะธะฝะบะฐั](/window-functions). ะะตะบะพะผะตะฝะดัั ะฝะตยะฟัะพััะพ ัะธัะฐัั, ะฐย[ะฟัะพัะพะดะธัั ะบััั](https://stepik.org/z/95367) โ ัยะฝะธะผ ะทะฝะฐะฝะธั ะฟัะตะฒัะฐััััั ะฒยะฝะฐะฒัะบะธ._

ะกะบะพะปัะทััะธะต ะฐะณัะตะณะฐัั โ ััะพ ัะตยะถะต ััะผะผะฐ ะธยััะตะดะฝะตะต. ะขะพะปัะบะพ ัะฐัััะธััะฒะฐัั ะธัยะฝะตยะฟะพยะฒัะตะผ ัะปะตะผะตะฝัะฐะผ ะฝะฐะฑะพัะฐ, ะฐยะฑะพะปะตะต ัะธัััะผ ัะฟะพัะพะฑะพะผ.

ะะฐะทะฑะตัะตะผัั ะฝะฐยะฟัะธะผะตัะฐั. ะะดะตัั ะฒะพะทัะผะตะผ ะดััะณัั ัะฐะฑะปะธัะบั โ `expenses`. ะะฝะฐ ะฟะพะบะฐะทัะฒะฐะตั ะดะพัะพะดั ะธยัะฐััะพะดั ะพะดะฝะพะณะพ ะธะทยัะพัััะดะฝะธะบะพะฒ (ะฟัััั ััะพ ะฑัะดะตั ะะฐัะธะฝะฐ) ะทะฐย9ยะผะตัััะตะฒ 2020ยะณะพะดะฐ:

```
โโโโโโโโฌโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโ
โ year โ month โ income โ expense โ
โโโโโโโโผโโโโโโโโผโโโโโโโโโผโโโโโโโโโโค
โ 2020 โ 1     โ 94     โ 82      โ
โ 2020 โ 2     โ 94     โ 75      โ
โ 2020 โ 3     โ 94     โ 104     โ
โ 2020 โ 4     โ 100    โ 94      โ
โ 2020 โ 5     โ 100    โ 99      โ
โ 2020 โ 6     โ 100    โ 105     โ
โ 2020 โ 7     โ 100    โ 95      โ
โ 2020 โ 8     โ 100    โ 110     โ
โ 2020 โ 9     โ 104    โ 104     โ
โโโโโโโโดโโโโโโโโดโโโโโโโโโดโโโโโโโโโโ
```

<ul>
    <li><a href="#rolling-avg">ัะบะพะปัะทััะตะต ััะตะดะฝะตะต</a>,</li>
    <li><a href="#frame">ััะตะนะผ</a>,</li>
    <li><a href="#cumulative-sum">ะฝะฐัะฐััะฐััะธะน ะธัะพะณ</a>,</li>
    <li><a href="#functions">ััะฝะบัะธะธ</a>.</li>
</ul>

ะัะต ะทะฐะฟัะพัั ะผะพะถะฝะพ ะฟะพะฒัะพัััั [ะฒยะฟะตัะพัะฝะธัะต](https://antonz.org/sqliter/sandbox/#window.db).

<h2 id="rolling-avg">ะกะบะพะปัะทััะตะต ััะตะดะฝะตะต ะฟะพยัะฐััะพะดะฐะผ</h2>

ะกัะดั ะฟะพยะดะฐะฝะฝัะผ, ะดะพัะพะดั ัยะะฐัะธะฝั ัะฐัััั: 94ะ โฝ ะฒยัะฝะฒะฐัะต โ 104ะ โฝ ะฒยัะตะฝััะฑัะต. ะยะฒะพั ัะฐััััยะปะธ ัะฐััะพะดั? ะกัะพะดั ัะปะพะถะฝะพ ัะบะฐะทะฐัั, ะผะตััั ะฝะฐยะผะตััั ะฝะตยะฟัะธัะพะดะธััั. ะงัะพะฑั ัะณะปะฐะดะธัั ััะธ ัะบะฐัะบะธ, ะธัะฟะพะปัะทััั ยซัะบะพะปัะทััะตะต ััะตะดะฝะตะตยป โ ะดะปั ะบะฐะถะดะพะณะพ ะผะตัััะฐ ัะฐัััะธััะฒะฐัั ััะตะดะฝะธะน ัะฐััะพะด ัยััะตัะพะผ ะฟัะตะดัะดััะตะณะพ ะธยัะปะตะดัััะตะณะพ ะผะตัััะฐ. ะะฐะฟัะธะผะตั:

- ัะบะพะปัะทััะตะต ััะตะดะฝะตะต ะทะฐยัะตะฒัะฐะปั = (ัะฝะฒะฐัั + ัะตะฒัะฐะปั + ะผะฐัั) / 3;
- ะทะฐยะผะฐัั = (ัะตะฒัะฐะปั + ะผะฐัั + ะฐะฟัะตะปั) / 3;
- ะทะฐยะฐะฟัะตะปั = (ะผะฐัั + ะฐะฟัะตะปั + ะผะฐะน) / 3;
- ะธยัะฐะบ ะดะฐะปะตะต.

ะะฐัััะธัะฐะตะผ ัะบะพะปัะทััะตะต ััะตะดะฝะตะต ะฟะพยะฒัะตะผ ะผะตัััะฐะผ:

<div class="row">
<div class="col-xs-12 col-sm-6">
    <strong>ะัะปะพ</strong>
    <figure><img alt="ะขะฐะฑะปะธัะฐ ัะฐััะพะดะพะฒ" src="window-expenses.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    <strong>ะกัะฐะปะพ</strong>
    <figure><img alt="ะกะบะพะปัะทััะตะต ััะตะดะฝะตะต" src="window-rolling-avg.png"></figure>
</div>
</div>

ะกัะพะปะฑะตั `roll_avg` ะฟะพะบะฐะทัะฒะฐะตั ัะบะพะปัะทััะตะต ััะตะดะฝะตะต ะฟะพยัะฐััะพะดะฐะผ ะทะฐยััะธ ะผะตัััะฐ (ัะตะบััะธะน, ะฟัะตะดัะดััะธะน ะธยัะปะตะดัััะธะน). ะขะตะฟะตัั ัะพัะพัะพ ะฒะธะดะฝะพ, ััะพ ัะฐััะพะดั ััะฐะฑะธะปัะฝะพ ัะฐัััั.

ะะฐะบ ะฟะตัะตะนัะธ ะพัยยซะฑัะปะพยป ะบยยซััะฐะปะพยป?

ะััะพััะธััะตะผ ัะฐะฑะปะธัั ะฟะพยะผะตัััะฐะผ:

```sql
select
  year, month, expense,
  null as roll_avg
from expenses
order by year, month;
```

```
โโโโโโโโฌโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโโ
โ year โ month โ expense โ roll_avg โ
โโโโโโโโผโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโค
โ 2020 โ 1     โ 82      โ          โ
โ 2020 โ 2     โ 75      โ          โ
โ 2020 โ 3     โ 104     โ          โ
โ 2020 โ 4     โ 94      โ          โ
โ 2020 โ 5     โ 99      โ          โ
โ 2020 โ 6     โ 105     โ          โ
โ 2020 โ 7     โ 95      โ          โ
โ 2020 โ 8     โ 110     โ          โ
โ 2020 โ 9     โ 104     โ          โ
โโโโโโโโดโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโ
```

ะขะตะฟะตัั ะฟัะพะนะดะตะผ ะพัยะฟะตัะฒะพะน ัััะพัะบะธ ะดะพยะฟะพัะปะตะดะฝะตะน. ะะฐยะบะฐะถะดะพะผ ัะฐะณะต ะฑัะดะตะผ ััะธัะฐัั ััะตะดะฝะตะต ะฟะพยะฟัะตะดัะดััะตะผั, ัะตะบััะตะผั ะธยัะปะตะดัััะตะผั ะทะฝะฐัะตะฝะธั ะธะทยััะพะปะฑัะฐ `expense`:

<div class="row">
<div class="col-xs-12 col-sm-6">
    1๏ธโฃ
    <figure><img alt="ะจะฐะณ 1" src="rolling-avg-03.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    2๏ธโฃ
    <figure><img alt="ะจะฐะณ 2" src="rolling-avg-04.png"></figure>
</div>
</div>
<div class="row">
<div class="col-xs-12 col-sm-6">
    3๏ธโฃ
    <figure><img alt="ะจะฐะณ 3" src="rolling-avg-05.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    4๏ธโฃ
    <figure><img alt="ะจะฐะณ 4" src="rolling-avg-06.png"></figure>
</div>
</div>
<div class="row">
<div class="col-xs-12 col-sm-6">
    5๏ธโฃ
    <figure><img alt="ะจะฐะณ 5" src="rolling-avg-07.png"></figure>
</div>
<div class="col-xs-12 col-sm-6 flex" style="align-items:center">
    <p>ะธ ัะฐะบ ะดะฐะปะตะต...</p>
</div>
</div>

ะะดะฝะพะน ะณะธัะบะพะน:

<div class="row">
<div class="col-xs-12 col-sm-6">
<figure>
  <img alt="ะะณัะตะณะฐัะธั: ัะบะพะปัะทััะตะต ััะตะดะฝะตะต" src="rolling-avg.gif">
</figure>
</div>
</div>

ะะบะฝะพ ะฝะฐยะบะฐะถะดะพะผ ัะฐะณะต ัะดะฒะธะณะฐะตััั ะฒะฝะธะท, ัะบะพะปัะทะธั โ ัะฐะบ ะธยะฟะพะปััะฐะตััั ัะบะพะปัะทััะตะต ััะตะดะฝะตะต. ะงัะพะฑั ะพะฟะธัะฐัั ะฝะฐยSQL, ะฟัะธะดะตััั ะฒัะฟะพะผะฝะธัั ะบะพะฝัะตะฟัะธั ััะตะนะผะพะฒ, ัยะบะพัะพัะพะน ะผัยะฟะพะทะฝะฐะบะพะผะธะปะธัั ะฒ [ััะฐััะตยะพยัะผะตัะตะฝะธะธ](/window-offset/):

1. ะะบะฝะพ ัะพััะพะธั ะธะทยะพะดะฝะพะน ะธะปะธ ะฝะตัะบะพะปัะบะธั ัะตะบัะธะน (ะฒยะฝะฐัะตะผ ัะปััะฐะต ัะตะบัะธั ะพะดะฝะฐ โ ะฒัะต ะทะฐะฟะธัะธ `expenses`).
2. ะะฝัััะธ ัะตะบัะธะธ ะทะฐะฟะธัะธ ัะฟะพััะดะพัะตะฝั ะฟะพยะบะพะฝะบัะตัะฝัะผ ััะพะปะฑัะฐะผ (`order by year, month`).
3. ะฃยะบะฐะถะดะพะน ะทะฐะฟะธัะธ ัะฒะพะน ััะตะนะผ.

ะคัะตะนะผ ะฝะฐยะบะฐะถะดะพะผ ัะฐะณะต ะพัะฒะฐััะฒะฐะตั ััะธ ะทะฐะฟะธัะธ โ ัะตะบัััั, ะฟัะตะดัะดัััั ะธยัะปะตะดััััั:

<div class="row">
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 1" src="rolling-1.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 2" src="rolling-2.png"></figure>
</div>
</div>

ะะพั ะบะฐะบ ะทะฐะฟะธัะฐัั ััะพ ะฝะฐยSQL:

```
window w as (
  order by year, month
  rows between 1 preceding and 1 following
)
```

ะกย`order by` ะฒัะต ะฟะพะฝััะฝะพ, ะฐยะฒัะพัะฐั ัััะพัะบะฐ โ ััะพ ะบะฐะบ ัะฐะท ะพะฟัะตะดะตะปะตะฝะธะต ััะตะนะผะฐ: ยซะฒัะฑัะฐัั ัััะพะบะธ ะพัย1ยะฟัะตะดัะดััะตะน ะดะพย1ยัะปะตะดัััะตะนยป. ะะฐยัะปะตะดัััะตะผ ัะฐะณะต ัะฐะทะฑะตัะตะผัั ัยััะตะนะผะฐะผะธ ะฟะพะดัะพะฑะฝะพ, ะฐยะฟะพะบะฐ ะทะฐะบะพะฝัะธะผ ัยะฝะฐัะธะผ ะทะฐะฟัะพัะพะผ.

ะกัะธัะฐะตะผ ััะตะดะฝะตะต ะฟะพยัะฐััะพะดะฐะผ โ ััะพ ััะฝะบัะธั `avg()`:

```
avg(expense) over w
```

ะะพะฑะฐะฒะธะผ ะพะบััะณะปะตะฝะธะต ะธยัะฒะตะดะตะผ ะฒัะต ะฒะผะตััะต:

```sql
select
  year, month, expense,
  round(avg(expense) over w) as roll_avg
from expenses
window w as (
  order by year, month
  rows between 1 preceding and 1 following
)
order by year, month;
```

```
โโโโโโโโฌโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโโ
โ year โ month โ expense โ roll_avg โ
โโโโโโโโผโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโค
โ 2020 โ 1     โ 82      โ 79.0     โ
โ 2020 โ 2     โ 75      โ 87.0     โ
โ 2020 โ 3     โ 104     โ 91.0     โ
โ 2020 โ 4     โ 94      โ 99.0     โ
โ 2020 โ 5     โ 99      โ 99.0     โ
โ 2020 โ 6     โ 105     โ 100.0    โ
โ 2020 โ 7     โ 95      โ 103.0    โ
โ 2020 โ 8     โ 110     โ 103.0    โ
โ 2020 โ 9     โ 104     โ 107.0    โ
โโโโโโโโดโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโ
```

ะกะบะพะปัะทััะตะต ััะตะดะฝะตะต ะฟะพยัะฐััะพะดะฐะผ ะณะพัะพะฒะพ!

<h2 id="frame">ะคัะตะนะผ</h2>

ะยะพะฑัะตะผ ัะปััะฐะต ะพะฟัะตะดะตะปะตะฝะธะต ััะตะนะผะฐ ะฒัะณะปัะดะธั ัะฐะบ:

```
rows between X preceding and Y following
```

ะะดะต `X` โ ะบะพะปะธัะตััะฒะพ ัััะพะบ ะฟะตัะตะด ัะตะบััะตะน, ะฐย`Y` โ ะบะพะปะธัะตััะฒะพ ัััะพะบ ะฟะพัะปะต ัะตะบััะตะน:

<div class="row">
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 1" src="frame-11.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 2" src="frame-12.png"></figure>
</div>
</div>

ะัะปะธ ัะบะฐะทะฐัั ะฒะผะตััะพ `X` ะธะปะธ `Y` ะทะฝะฐัะตะฝะธะต `unbounded` โ ััะพ ะทะฝะฐัะธั ยซะณัะฐะฝะธัะฐ ัะตะบัะธะธยป:

<div class="row">
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 3" src="frame-31.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 4" src="frame-32.png"></figure>
</div>
</div>

ะัะปะธ ัะบะฐะทะฐัั ะฒะผะตััะพ `X preceding` ะธะปะธ `Y following` ะทะฝะฐัะตะฝะธะต `current row` โ ััะพ ะทะฝะฐัะธั ยซัะตะบััะฐั ะทะฐะฟะธััยป:

<div class="row">
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 5" src="frame-21.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 6" src="frame-22.png"></figure>
</div>
</div>

ะคัะตะนะผ ะฝะธะบะพะณะดะฐ ะฝะตยะฒััะพะดะธั ะทะฐยะณัะฐะฝะธัั ัะตะบัะธะธ, ะตัะปะธ ััะพะปะบะฝัะปัั ัยะฝะตะน โ ะพะฑัะตะทะฐะตััั:

<div class="row">
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 7" src="frame-41.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    <figure><img alt="ะคัะตะนะผ 8" src="frame-42.png"></figure>
</div>
</div>

ะะพะพะฑัะต, ัยััะตะนะผะพะฒ ะฝะฐะผะฝะพะณะพ ะฑะพะปััะต ะฒะพะทะผะพะถะฝะพััะตะน, ะฝะพยะผัยะพะณัะฐะฝะธัะธะผัั ััะธะผะธ. ะะพะดัะพะฑะฝะพััะธ ัะฐะทะฑะตัะตะผ ะฝะฐยะบัััะต.

<h2 id="cumulative-sum">ะัะธะฑัะปั ะฝะฐัะฐััะฐััะธะผ ะธัะพะณะพะผ</h2>

ะะปะฐะณะพะดะฐัั ัะบะพะปัะทััะตะผั ััะตะดะฝะตะผั, ะผัยะฒัััะฝะธะปะธ, ััะพ ะฒย`expenses` ัะฐัััั ะธยะดะพัะพะดั, ะธยัะฐััะพะดั. ะยะบะฐะบ ะพะฝะธ ัะพะพัะฝะพััััั ะดััะณ ัยะดััะณะพะผ? ะฅะพัะตััั ะฟะพะฝััั, ะฝะฐัะพะดะธัััยะปะธ ัะตะปะพะฒะตะบ ยซะฒยะฟะปััะตยป ะธะปะธ ยซะฒยะผะธะฝััะตยป ัยััะตัะพะผ ะฒัะตั ะทะฐัะฐะฑะพัะฐะฝะฝัั ะธยะฟะพััะฐัะตะฝะฝัั ะดะตะฝะตะณ.

ะัะธัะตะผ ะฒะฐะถะฝะพ ะฟะพะฝะธะผะฐัั ะฝะตยะฝะฐยะบะพะฝะตั ะณะพะดะฐ, ะฐยะฝะฐยะบะฐะถะดัะน ะผะตััั. ะะพัะพะผั ััะพ ะตัะปะธ ะฟะพยะธัะพะณะฐะผ ะณะพะดะฐ ัยะะฐัะธะฝั ะฒัะต ะะ, ะฐยะฒยะธัะฝะต ััะปะฐ ะฒยะผะธะฝัั โ ััะพ ะฟะพัะตะฝัะธะฐะปัะฝะฐั ะฟัะพะฑะปะตะผะฐ (ัยะบะพะผะฟะฐะฝะธะน ัะฐะบัั ัะธััะฐัะธั ะฝะฐะทัะฒะฐัั ยซะบะฐััะพะฒัะผ ัะฐะทััะฒะพะผยป).

ะะพััะพะผั ะฟะพััะธัะฐะตะผ ะดะพัะพะดั ะธยัะฐััะพะดั ะฟะพยะผะตัััะฐะผ ะฝะฐัะฐััะฐััะธะผ ะธัะพะณะพะผ (ะบัะผัะปััะธะฒะฝะพ):

- ะบัะผัะปััะธะฒะฝัะน ะดะพัะพะด ะทะฐยัะฝะฒะฐัั = ัะฝะฒะฐัั;
- ะทะฐยัะตะฒัะฐะปั = ัะฝะฒะฐัั + ัะตะฒัะฐะปั;
- ะทะฐยะผะฐัั = ัะฝะฒะฐัั + ัะตะฒัะฐะปั + ะผะฐัั;
- ะทะฐยะฐะฟัะตะปั = ัะฝะฒะฐัั + ัะตะฒัะฐะปั + ะผะฐัั + ะฐะฟัะตะปั;
- ะธยัะฐะบ ะดะฐะปะตะต.

<div class="row">
<div class="col-xs-12 col-sm-8">
    <figure><img alt="ะัะธะฑัะปั ะฝะฐัะฐััะฐััะธะผ ะธัะพะณะพะผ" src="window-cumulative-sum.png"></figure>
</div>
</div>

`t_income` ะฟะพะบะฐะทัะฒะฐะตั ะดะพัะพะดั ะฝะฐัะฐััะฐััะธะผ ะธัะพะณะพะผ, `t_expense` โ ัะฐััะพะดั, ะฐย`t_profit` โ ะฟัะธะฑัะปั.

```
t_profit = t_income - t_expense
```

ะะฐะบ ัะฐัััะธัะฐัั ะบัะผัะปััะธะฒะฝัะต ะฟะพะบะฐะทะฐัะตะปะธ?

ะััะพััะธััะตะผ ัะฐะฑะปะธัั ะฟะพยะผะตัััะฐะผ:

```sql
select
  year, month, income, expense,
  null as t_income,
  null as t_expense,
  null as t_profit
from expenses
order by year, month;
```

```
โโโโโโโโฌโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโโโโ
โ year โ month โ income โ expense โ t_income โ t_expense โ t_profit โ
โโโโโโโโผโโโโโโโโผโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโโโค
โ 2020 โ 1     โ 94     โ 82      โ          โ           โ          โ
โ 2020 โ 2     โ 94     โ 75      โ          โ           โ          โ
โ 2020 โ 3     โ 94     โ 104     โ          โ           โ          โ
โ 2020 โ 4     โ 100    โ 94      โ          โ           โ          โ
โ 2020 โ 5     โ 100    โ 99      โ          โ           โ          โ
โ 2020 โ 6     โ 100    โ 105     โ          โ           โ          โ
โ 2020 โ 7     โ 100    โ 95      โ          โ           โ          โ
โ 2020 โ 8     โ 100    โ 110     โ          โ           โ          โ
โ 2020 โ 9     โ 104    โ 104     โ          โ           โ          โ
โโโโโโโโดโโโโโโโโดโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโโโ
```

ะขะตะฟะตัั ะฟัะพะนะดะตะผ ะพัยะฟะตัะฒะพะน ัััะพัะบะธ ะดะพยะฟะพัะปะตะดะฝะตะน. ะะฐยะบะฐะถะดะพะผ ัะฐะณะต ะฑัะดะตะผ ััะธัะฐัั ััะผะผะฐัะฝัะต ะฟะพะบะฐะทะฐัะตะปะธ ะพัยะฝะฐัะฐะปะฐ ัะฐะฑะปะธัั ะดะพยัะตะบััะตะน ัััะพะบะธ:

<div class="row">
<div class="col-xs-12 col-sm-6">
    1๏ธโฃ
    <figure><img alt="ะจะฐะณ 1" src="cumulative-sum-03.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    2๏ธโฃ
    <figure><img alt="ะจะฐะณ 2" src="cumulative-sum-04.png"></figure>
</div>
</div>
<div class="row">
<div class="col-xs-12 col-sm-6">
    3๏ธโฃ
    <figure><img alt="ะจะฐะณ 3" src="cumulative-sum-05.png"></figure>
</div>
<div class="col-xs-12 col-sm-6">
    4๏ธโฃ
    <figure><img alt="ะจะฐะณ 4" src="cumulative-sum-06.png"></figure>
</div>
</div>
<div class="row">
<div class="col-xs-12 col-sm-6">
    5๏ธโฃ
    <figure><img alt="ะจะฐะณ 5" src="cumulative-sum-07.png"></figure>
</div>
<div class="col-xs-12 col-sm-6 flex" style="align-items:center">
    <p>ะธ ัะฐะบ ะดะฐะปะตะต...</p>
</div>
</div>

ะะดะฝะพะน ะณะธัะบะพะน:

<div class="row">
<div class="col-xs-12 col-sm-8">
<figure>
  <img alt="ะะณัะตะณะฐัะธั: ััะผะผะฐ ะฝะฐัะฐััะฐััะธะผ ะธัะพะณะพะผ" src="cumulative-sum.gif">
</figure>
</div>
</div>

ะะบะฝะพ ะฝะฐยะบะฐะถะดะพะผ ัะฐะณะต ะพัะฒะฐััะฒะฐะตั ัััะพะบะธ ะพัยะฝะฐัะฐะปะฐ ัะฐะฑะปะธัั ะดะพยัะตะบััะตะน ะทะฐะฟะธัะธ. ะัยัะถะต ะทะฝะฐัะตะผ, ะบะฐะบ ััะพัะผัะปะธัะพะฒะฐัั ะฟะพะดัะพะดััะธะน ััะตะนะผ:

```
window w as (
  order by year, month
  rows between unbounded preceding and current row
)
```

ะกัะธัะฐะตะผ ััะผะผั ะฟะพยะดะพัะพะดะฐะผ ะธ ัะฐััะพะดะฐะผ โ ััะพ ััะฝะบัะธั `sum()`:

```
sum(income) over w as t_income,
sum(expense) over w as t_expense,
```

ะัะธะฑัะปั ััะธัะฐะตะผ ะบะฐะบ ัะฐะทะฝะธัั ะผะตะถะดั ะดะพัะพะดะฐะผะธ ะธ ัะฐััะพะดะฐะผะธ:

```
(sum(income) over w) - (sum(expense) over w) as t_profit
```

ะัะต ะฒะผะตััะต:

```sql
select
  year, month, income, expense,
  sum(income) over w as t_income,
  sum(expense) over w as t_expense,
  (sum(income) over w) - (sum(expense) over w) as t_profit
from expenses
window w as (
  order by year, month
  rows between unbounded preceding and current row
)
order by year, month;
```

```
โโโโโโโโฌโโโโโโโโฌโโโโโโโโโฌโโโโโโโโโโฌโโโโโโโโโโโฌโโโโโโโโโโโโฌโโโโโโโโโโโ
โ year โ month โ income โ expense โ t_income โ t_expense โ t_profit โ
โโโโโโโโผโโโโโโโโผโโโโโโโโโผโโโโโโโโโโผโโโโโโโโโโโผโโโโโโโโโโโโผโโโโโโโโโโโค
โ 2020 โ 1     โ 94     โ 82      โ 94       โ 82        โ 12       โ
โ 2020 โ 2     โ 94     โ 75      โ 188      โ 157       โ 31       โ
โ 2020 โ 3     โ 94     โ 104     โ 282      โ 261       โ 21       โ
โ 2020 โ 4     โ 100    โ 94      โ 382      โ 355       โ 27       โ
โ 2020 โ 5     โ 100    โ 99      โ 482      โ 454       โ 28       โ
โ 2020 โ 6     โ 100    โ 105     โ 582      โ 559       โ 23       โ
โ 2020 โ 7     โ 100    โ 95      โ 682      โ 654       โ 28       โ
โ 2020 โ 8     โ 100    โ 110     โ 782      โ 764       โ 18       โ
โ 2020 โ 9     โ 104    โ 104     โ 886      โ 868       โ 18       โ
โโโโโโโโดโโโโโโโโดโโโโโโโโโดโโโโโโโโโโดโโโโโโโโโโโดโโโโโโโโโโโโดโโโโโโโโโโโ
```

ะะพย`t_profit` ะฒะธะดะฝะพ, ััะพ ะดะตะปะฐ ัยะะฐัะธะฝั ะธะดัั ะฝะตะฟะปะพัะพ. ะยะฝะตะบะพัะพััั ะผะตัััะฐั ัะฐััะพะดั ะฟัะตะฒััะฐัั ะดะพัะพะดั, ะฝะพยะฑะปะฐะณะพะดะฐัั ะฝะฐะบะพะฟะปะตะฝะฝะพะน ยซะดะตะฝะตะถะฝะพะน ะฟะพะดััะบะตยป ะบะฐััะพะฒะพะณะพ ัะฐะทััะฒะฐ ะฝะตยะฟัะพะธััะพะดะธั.

<h2 id="functions">ะคัะฝะบัะธะธ ะฐะณัะตะณะฐัะธะธ</h2>

ะกะบะพะปัะทััะธะต ะฐะณัะตะณะฐัั ะธัะฟะพะปัะทััั ัะตยะถะต ัะฐะผัะต ััะฝะบัะธะธ, ััะพ ะธยะฐะณัะตะณะฐัั ะพะฑััะฝัะต:

- `min()` ะธย`max()`
- `count()`, `avg()` ะธย`sum()`

ะะฐะทะฝะธัะฐ ัะพะปัะบะพ ะฒยะฝะฐะปะธัะธะธ ััะตะนะผะฐ ัยัะบะพะปัะทััะธั ะฐะณัะตะณะฐัะพะฒ.

<p class="text-centered">โ โ โ</p>

ะัยัะฐััะผะพััะตะปะธ ัะตัััะต ะบะปะฐััะฐ ะทะฐะดะฐั, ะบะพัะพััะต ัะตัะฐัััั ัยะฟะพะผะพััั ะพะบะพะฝะฝัั ััะฝะบัะธะน ะฒยSQL:

- ะะฐะฝะถะธัะพะฒะฐะฝะธะต (ะฒัะตะฒะพะทะผะพะถะฝัะต ัะตะนัะธะฝะณะธ).
- ะกัะฐะฒะฝะตะฝะธะต ัะพยัะผะตัะตะฝะธะตะผ (ัะพัะตะดะฝะธะต ัะปะตะผะตะฝัั ะธยะณัะฐะฝะธัั).
- ะะณัะตะณะฐัะธั (ะบะพะปะธัะตััะฒะพ, ััะผะผะฐ ะธยััะตะดะฝะตะต).
- ะกะบะพะปัะทััะธะต ะฐะณัะตะณะฐัั (ััะผะผะฐ ะธยััะตะดะฝะตะต ะฒยะดะธะฝะฐะผะธะบะต).

ะขะตะฟะตัั ะฟะพะฟัะพะฑัะนัะต ะฟัะธะผะตะฝะธัั ยซะพะบะพัะบะธยป ะฝะฐยะฟัะฐะบัะธะบะต!

ะงัะพะฑั ัะทะฝะฐัั ะฑะพะปััะต ะพะฑยะพะบะพะฝะฝัั ััะฝะบัะธัั ะธะปะธ ะฟะพััะตะฝะธัะพะฒะฐัััั โ <a href="https://stepik.org/z/95367"><strong>ะทะฐะฟะธััะฒะฐะนัะตัั ะฝะฐยะบััั</strong></a> ๐



