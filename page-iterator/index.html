<!doctype html><html lang=en>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta name=yandex-verification content="166c4872c92b3261">
<meta name=google-site-verification content="RDIpvK7QdMQQUb3kxVN3FAjfDdKdfHQSyGVfLb-GaPU">
<title>–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä –≤ Python</title>
<meta name=description content="–û–±—Ö–æ–¥–∏–º –¥–∞—Ç–∞—Å–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.">
<meta name=robots content="index, follow">
<link rel=stylesheet type=text/css href=/assets/css/style.e5485f3d9455cd273d18af061d88ebe20e91b4df8cb118745360b642b5dfbcbe.css>
<link rel=icon href=/assets/favicon/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=/assets/favicon/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=/assets/favicon/favicon-32x32.png>
<link rel=apple-touch-icon href=/assets/favicon/apple-touch-icon.png>
<link rel=mask-icon href=/assets/favicon/safari-pinned-tab.svg>
<meta name=theme-color content="#fff">
<meta name=msapplication-TileColor content="#fff">
<link rel=canonical href=https://antonz.ru/page-iterator/>
<meta name=author content="–ê–Ω—Ç–æ–Ω –ñ–∏—è–Ω–æ–≤">
<meta property="og:type" content="article">
<meta property="og:title" content="–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä –≤ Python">
<meta property="og:description" content="–û–±—Ö–æ–¥–∏–º –¥–∞—Ç–∞—Å–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.">
<meta property="og:url" content="https://antonz.ru/page-iterator/">
<meta property="og:image" content="https://antonz.ru/page-iterator/cover.png">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:title content="–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä –≤ Python">
<meta name=twitter:description content="–û–±—Ö–æ–¥–∏–º –¥–∞—Ç–∞—Å–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.">
<meta name=twitter:url content="https://antonz.ru/page-iterator/">
<meta name=twitter:site content="@nalgeon">
<meta name=twitter:image content="https://antonz.ru/page-iterator/cover.png"></head>
<body>
<div class=header>
<div class=container>
<div class=row>
<div class="col-xs-6 col-sm-3">
<a class=img-link href=/>
<img src=/assets/stopwar.svg class=header-icon>
</a>¬†
<a href=/>
<strong>–ê–Ω—Ç–æ–Ω –ñ–∏—è–Ω–æ–≤</strong>
</a>
</div>
<div class="col-xs-12 col-sm-6 col-md-4 hidden-mobile">
<a class=menu__link href=/projects/>
<span>–ø—Ä–æ–µ–∫—Ç—ã</span>
</a>
<a class=menu__link href=/all/>
<span>–±–ª–æ–≥</span>
</a>
<a class=menu__link href=/#about>
<span>–∫–æ–Ω—Ç–∞–∫—Ç—ã</span>
</a>
<a class=menu__link href=https://antonz.org>
<span>en</span>
</a>
</div>
<div class="col-xs-6 col-sm-3"><div class=search-module>
<form action=https://antonz.ru/search/ method=get target=_self accept-charset=utf-8>
<input type=hidden name=searchid value=2403959>
<input type=hidden name=l10n value=ru>
<input type=hidden name=reqenc>
<input type=search name=text placeholder="–ø–æ–∏—Å–∫ –ø–æ —Å–∞–π—Ç—É">
</form>
</div></div>
</div>
</div>
</div>
<div class=storey>
<div class=container>
<article class=post>
<div class=row>
<div class="col-xs-12 col-sm-10 article">
<header>
<h1>–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä –≤ Python</h1>
</header>
<p>–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –≤—ã¬†—Å—á–∏—Ç–∞–µ—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ¬†–æ–≥—Ä–æ–º–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É –∏–≥—Ä—É—à–µ–∫, –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –ø–æ¬†–≤—Å–µ–π —Å—Ç—Ä–∞–Ω–µ –∑–∞¬†–ø—Ä–æ—à–ª—ã–π –≥–æ–¥:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>reader</span> <span style=color:#000>=</span> <span style=color:#000>fetch_toys</span>()
<span style=color:#a90d91>for</span> <span style=color:#000>item</span> <span style=color:#000>in</span> <span style=color:#000>reader</span>:
    <span style=color:#000>process_single</span>(<span style=color:#000>item</span>)
</code></pre></div><p><code>process_single()</code> –∑–∞–Ω–∏–º–∞–µ—Ç 10¬†–º—Å, —Ç–∞–∫ —á—Ç–æ 400¬†–º–ª–Ω –∏–≥—Ä—É—à–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è –∑–∞¬†46¬†–¥–Ω–µ–π üò±</p>
<p>–í¬†—Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–∂–∏–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–∏–∞–ª–æ–≥–∞ –≤–∞–º —É–¥–∞–µ—Ç—Å—è —É–±–µ–¥–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —á—Ç–æ —Ç–∞–∫ –Ω–µ¬†–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ. –ù–∞¬†—Å–≤–µ—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è <code>process_batch()</code>, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 10000 –∏–≥—Ä—É—à–µ–∫ –∑–∞¬†1¬†—Å–µ–∫. –≠—Ç–æ —É–∂–µ 11¬†—á–∞—Å–æ–≤ –Ω–∞¬†–≤—Å–µ –∏–≥—Ä—É—à–∫–∏, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏—è—Ç–Ω–µ–µ.</p>
<p>–ö–∞–∫¬†–±—ã —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–π—Ç–∏ –ø–æ¬†–¥–∞—Ç–∞—Å–µ—Ç—É –ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ¬†10¬†—Ç—ã—Å—è—á –∑–∞–ø–∏—Å–µ–π? –¢—É—Ç –∏¬†–ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä!</p>
<h2 id=–Ω–∞–∏–≤–Ω—ã–π-–ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∏–∫>–ù–∞–∏–≤–Ω—ã–π –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∏–∫</h2>
<p>–ü—Ä–æ–π–¥–µ–º –ø–æ¬†–∏—Å—Ö–æ–¥–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü—É. –ö–∞–∫ –∑–∞–ø–æ–ª–Ω–∏—Ç—Å—è¬†‚Äî –æ—Ç–¥–∞–¥–∏–º —á–µ—Ä–µ–∑ <code>yield</code> –∏¬†–Ω–∞—á–Ω–µ–º –∑–∞–ø–æ–ª–Ω—è—Ç—å —Å–ª–µ–¥—É—é—â—É—é. –ë—É–¥–µ–º –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å, –ø–æ–∫–∞ –∏—Å—Ö–æ–¥–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ¬†–∑–∞–∫–æ–Ω—á–∏—Ç—Å—è:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>def</span> <span style=color:#000>paginate</span>(<span style=color:#000>iterable</span>, <span style=color:#000>page_size</span>):
    <span style=color:#000>page</span> <span style=color:#000>=</span> []
    <span style=color:#a90d91>for</span> <span style=color:#000>item</span> <span style=color:#000>in</span> <span style=color:#000>iterable</span>:
        <span style=color:#000>page</span><span style=color:#000>.</span><span style=color:#000>append</span>(<span style=color:#000>item</span>)
        <span style=color:#a90d91>if</span> <span style=color:#a90d91>len</span>(<span style=color:#000>page</span>) <span style=color:#000>==</span> <span style=color:#000>page_size</span>:
            <span style=color:#a90d91>yield</span> <span style=color:#000>page</span>
            <span style=color:#000>page</span> <span style=color:#000>=</span> []
    <span style=color:#a90d91>yield</span> <span style=color:#000>page</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#000>reader</span> <span style=color:#000>=</span> <span style=color:#000>fetch_toys</span>()
<span style=color:#000>page_size</span> <span style=color:#000>=</span> <span style=color:#1c01ce>10_000</span>
<span style=color:#a90d91>for</span> <span style=color:#000>page</span> <span style=color:#000>in</span> <span style=color:#000>paginate</span>(<span style=color:#000>reader</span>, <span style=color:#000>page_size</span>):
    <span style=color:#000>process_batch</span>(<span style=color:#000>page</span>)
</code></pre></div><p>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—á–∞—è, –Ω–æ¬†–µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∫–∞. –¢–∞–∫–æ–π –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –æ–±—Ö–æ–¥ –∑–∞–º–µ—Ç–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±—ã—á–Ω–æ–≥–æ –∏—Ç–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ¬†–æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏.</p>
<h2 id=—Å–∫–æ—Ä–æ—Å—Ç—å-–æ–±—Ö–æ–¥–∞>–°–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ö–æ–¥–∞</h2>
<p>–°—Ä–∞–≤–Ω–∏–º –¥–≤–∞ –æ–±—Ö–æ–¥–∞ ‚Äî –æ–¥–∏–Ω–æ—á–Ω—ã–π –∏¬†–ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>def</span> <span style=color:#000>one_by_one</span>(<span style=color:#000>a</span>, <span style=color:#000>b</span>):
    <span style=color:#c41a16>&#34;&#34;&#34;Processes records one-by-one, without pagination&#34;&#34;&#34;</span>
    <span style=color:#000>rdr</span> <span style=color:#000>=</span> <span style=color:#000>reader</span>(<span style=color:#000>a</span>, <span style=color:#000>b</span>)
    <span style=color:#a90d91>for</span> <span style=color:#000>record</span> <span style=color:#000>in</span> <span style=color:#000>rdr</span>:
        <span style=color:#000>process_single</span>(<span style=color:#000>record</span>)

<span style=color:#a90d91>def</span> <span style=color:#000>batch</span>(<span style=color:#000>page_size</span>, <span style=color:#000>a</span>, <span style=color:#000>b</span>):
    <span style=color:#c41a16>&#34;&#34;&#34;Processes records in batches, with pagination&#34;&#34;&#34;</span>
    <span style=color:#000>rdr</span> <span style=color:#000>=</span> <span style=color:#000>reader</span>(<span style=color:#000>a</span>, <span style=color:#000>b</span>)
    <span style=color:#a90d91>for</span> <span style=color:#000>page</span> <span style=color:#000>in</span> <span style=color:#000>paginate</span>(<span style=color:#000>rdr</span>, <span style=color:#000>page_size</span>):
        <span style=color:#000>process_batch</span>(<span style=color:#000>page</span>)

<span style=color:#000>times</span> <span style=color:#000>=</span> <span style=color:#1c01ce>10</span>

<span style=color:#000>page_size</span> <span style=color:#000>=</span> <span style=color:#1c01ce>10_000</span>
<span style=color:#000>a</span> <span style=color:#000>=</span> <span style=color:#1c01ce>1_000_000</span>
<span style=color:#000>b</span> <span style=color:#000>=</span> <span style=color:#1c01ce>2_000_000</span>

<span style=color:#000>fn</span> <span style=color:#000>=</span> <span style=color:#a90d91>lambda</span>: <span style=color:#000>one_by_one</span>(<span style=color:#000>a</span>, <span style=color:#000>b</span>)
<span style=color:#000>total</span> <span style=color:#000>=</span> <span style=color:#000>timeit</span><span style=color:#000>.</span><span style=color:#000>timeit</span>(<span style=color:#000>fn</span>, <span style=color:#000>number</span><span style=color:#000>=</span><span style=color:#000>times</span>)
<span style=color:#000>it_time</span> <span style=color:#000>=</span> <span style=color:#a90d91>round</span>(<span style=color:#000>total</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1000</span> <span style=color:#000>/</span> <span style=color:#000>times</span>)
<span style=color:#a90d91>print</span>(<span style=color:#c41a16>f</span><span style=color:#c41a16>&#34;One-by-one (baseline): </span><span style=color:#c41a16>{</span><span style=color:#000>it_time</span><span style=color:#c41a16>}</span><span style=color:#c41a16> ms&#34;</span>)

<span style=color:#000>fn</span> <span style=color:#000>=</span> <span style=color:#a90d91>lambda</span>: <span style=color:#000>batch</span>(<span style=color:#000>page_size</span>, <span style=color:#000>a</span>, <span style=color:#000>b</span>)
<span style=color:#000>total</span> <span style=color:#000>=</span> <span style=color:#000>timeit</span><span style=color:#000>.</span><span style=color:#000>timeit</span>(<span style=color:#000>fn</span>, <span style=color:#000>number</span><span style=color:#000>=</span><span style=color:#000>times</span>)
<span style=color:#000>it_time</span> <span style=color:#000>=</span> <span style=color:#a90d91>round</span>(<span style=color:#000>total</span> <span style=color:#000>*</span> <span style=color:#1c01ce>1000</span> <span style=color:#000>/</span> <span style=color:#000>times</span>)
<span style=color:#a90d91>print</span>(<span style=color:#c41a16>f</span><span style=color:#c41a16>&#34;Fill page with append(): </span><span style=color:#c41a16>{</span><span style=color:#000>it_time</span><span style=color:#c41a16>}</span><span style=color:#c41a16> ms&#34;</span>)
</code></pre></div><p>–í–æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞¬†1¬†–º–ª–Ω –∑–∞–ø–∏—Å–µ–π –∏¬†—Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–∞–∑–º–µ—Ä–æ–º –≤¬†10¬†—Ç—ã—Å—è—á:</p>
<pre tabindex=0><code>One-by-one (baseline):   161 ms
Fill page with append(): 227 ms
</code></pre><p>–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –æ–±—Ö–æ–¥ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø–æ—á—Ç–∏ –≤¬†–ø–æ–ª—Ç–æ—Ä–∞ —Ä–∞–∑–∞!</p>
<p>–î–µ–ª–æ –≤¬†—Ç–æ–º, —á—Ç–æ –Ω–∞¬†–∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ü–∏–∫–ª–∞ –º—ã¬†—Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∏¬†–∑–∞—Ç–µ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∑–∞–ø–æ–ª–Ω—è–µ–º –µ–≥–æ. –ü–∏—Ç–æ–Ω—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –º–∞—Å—Å–∏–≤–∞ –ø–æ–¥ —Å–ø–∏—Å–∫–æ–º, –∞¬†—ç—Ç–æ –∑–∞—Ç—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è¬†‚Äî O(n) –æ—Ç¬†–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤¬†—Å–ø–∏—Å–∫–µ.</p>
<h2 id=—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è-—Å—Ç—Ä–∞–Ω–∏—Ü–∞>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h2>
<p>–ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –Ω—É–∂–Ω–æ–π –¥–ª–∏–Ω—ã –∏¬†–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü.</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>def</span> <span style=color:#000>paginate</span>(<span style=color:#000>iterable</span>, <span style=color:#000>page_size</span>):
    <span style=color:#000>page</span> <span style=color:#000>=</span> [<span style=color:#a90d91>None</span>] <span style=color:#000>*</span> <span style=color:#000>page_size</span>
    <span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#1c01ce>0</span>
    <span style=color:#a90d91>for</span> <span style=color:#000>item</span> <span style=color:#000>in</span> <span style=color:#000>iterable</span>:
        <span style=color:#000>page</span>[<span style=color:#000>idx</span>] <span style=color:#000>=</span> <span style=color:#000>item</span>
        <span style=color:#000>idx</span> <span style=color:#000>+=</span> <span style=color:#1c01ce>1</span>
        <span style=color:#a90d91>if</span> <span style=color:#000>idx</span> <span style=color:#000>==</span> <span style=color:#000>page_size</span>:
            <span style=color:#a90d91>yield</span> <span style=color:#000>page</span>
            <span style=color:#000>idx</span> <span style=color:#000>=</span> <span style=color:#1c01ce>0</span>
    <span style=color:#a90d91>yield</span> <span style=color:#000>page</span>[:<span style=color:#000>idx</span>]
</code></pre></div><p>–ü–æ–≤—Ç–æ—Ä–∏–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:</p>
<pre tabindex=0><code>One-by-one (baseline):   161 ms
Fill page with append(): 227 ms
Use fixed-size page:     162 ms
</code></pre><p>–ó–∞–º–µ—Ç–Ω–æ –±—ã—Å—Ç—Ä–µ–µ! –°–∫–æ—Ä–æ—Å—Ç—å —Å—Ä–∞–≤–Ω—è–ª–∞—Å—å —Å –æ–±—ã—á–Ω—ã–º –∏—Ç–µ—Ä–∏—Ä–æ–≤–∞–Ω–∏–º –ø–æ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏.</p>
<h2 id=–∏—Ç–µ—Ä–∞—Ü–∏—è-—Å—Ä–µ–∑–∞–º–∏>–ò—Ç–µ—Ä–∞—Ü–∏—è —Å—Ä–µ–∑–∞–º–∏</h2>
<p>–ú–æ–∂–Ω–æ¬†–ª–∏ –µ—â—ë –±—ã—Å—Ç—Ä–µ–µ? –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏¬†‚Äî –Ω–µ—Ç. –ê¬†–≤–æ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏¬†‚Äî –¥–∞, –µ—Å–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –¥–µ–π—Å—Ç–≤–∏–π –∏–∑¬†–∫–æ–¥–∞ –Ω–∞¬†–ø–∏—Ç–æ–Ω–µ –≤¬†–±–∏–±–ª–∏–æ—Ç–µ—á–Ω—ã–π –∫–æ–¥ –Ω–∞¬†—Å–∏. –í¬†—ç—Ç–æ–º –ø–æ–º–æ–∂–µ—Ç –º–æ–¥—É–ª—å <code>itertools()</code> –∏¬†–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏—è <code>islice()</code>:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#a90d91>def</span> <span style=color:#000>paginate</span>(<span style=color:#000>iterable</span>, <span style=color:#000>page_size</span>):
    <span style=color:#000>it</span> <span style=color:#000>=</span> <span style=color:#a90d91>iter</span>(<span style=color:#000>iterable</span>)
    <span style=color:#000>slicer</span> <span style=color:#000>=</span> <span style=color:#a90d91>lambda</span>: <span style=color:#a90d91>list</span>(<span style=color:#000>itertools</span><span style=color:#000>.</span><span style=color:#000>islice</span>(<span style=color:#000>it</span>, <span style=color:#000>page_size</span>))
    <span style=color:#a90d91>return</span> <span style=color:#a90d91>iter</span>(<span style=color:#000>slicer</span>, [])
</code></pre></div><p>–í–æ—Ç —á—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:</p>
<ul>
<li><code>islice()</code> —Å–æ–∑–¥–∞—ë—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä (–Ω–∞–∑–æ–≤–µ–º –µ–≥–æ —Å–ª–∞–π—Å–µ—Ä–æ–º), –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—É—é –µ–º—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–æ–∫–∞ –Ω–µ¬†–≤—ã–±–µ—Ä–µ—Ç –∏–∑¬†–Ω–µ–µ <code>page_size</code> —ç–ª–µ–º–µ–Ω—Ç–æ–≤;</li>
<li><code>list()</code> –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑¬†—ç—Ç–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–æ–≥–æ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞¬†‚Äî –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞;</li>
<li>–ø–æ—Å–∫–æ–ª—å–∫—É <code>islice()</code> —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞, –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤—ã–∑–æ–≤–µ –æ–Ω¬†–ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å¬†—Ç–æ–≥–æ¬†–∂–µ –º–µ—Å—Ç–∞, –≥–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –¥–æ¬†—ç—Ç–æ–≥–æ;</li>
<li>–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è <code>iter(slicer, [])</code> —Å–æ–∑–¥–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞¬†–∫–∞–∂–¥–æ–º —à–∞–≥–µ –≤—ã–∑—ã–≤–∞–µ—Ç —Å–ª–∞–π—Å–µ—Ä;</li>
<li>—Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Ñ—É–Ω–∫—Ü–∏—è <code>paginate()</code> –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞¬†–∫–∞–∂–¥–æ–º —à–∞–≥–µ –≤—ã–±–∏—Ä–∞–µ—Ç –æ—á–µ—Ä–µ–¥–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ —Å–ª–∞–π—Å–µ—Ä, –ø—Ä–æ–≤–∏–≥–∞—è—Å—å –ø–æ¬†–æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ ‚Äî –ø–æ–∫–∞ –æ–Ω–∞ –Ω–µ¬†–∑–∞–∫–æ–Ω—á–∏—Ç—Å—è.</li>
</ul>
<p>–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –¥–æ —á–µ–≥–æ —Ö–æ—Ä–æ—à —Ç–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç:</p>
<pre tabindex=0><code>One-by-one (baseline):   161 ms
Fill page with append(): 227 ms
Use fixed-size page:     162 ms
Use islice:               93 ms
</code></pre><p>–ù–∞ 40%¬†–±—ã—Å—Ç—Ä–µ–µ –æ–±—ã—á–Ω–æ–≥–æ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞ –ø–æ¬†–æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏!</p>
<h2 id=–∏—Ç–æ–≥–æ>–ò—Ç–æ–≥–æ</h2>
<p>–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –æ–±—Ö–æ–¥ –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ, –≥–¥–µ –ø–∞–∫–µ—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–ª—å–Ω–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞–±–æ—Ä–∞ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö. –ß—Ç–æ–±—ã –Ω–µ¬†–ø–∏—Å–∞—Ç—å —Ç–∞–∫–æ–π –æ–±—Ö–æ–¥ –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å¬†–Ω—É–ª—è, —É–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π <em>–ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä</em>.</p>
<p>–ü–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Å–ø–∏—Å–æ–∫, —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ¬†‚Äî –∏–∑-–∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –º–∞—Å—Å–∏–≤–∞. –õ—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, –∞¬†–µ—â–µ –ª—É—á—à–µ¬†‚Äî –∏—Ç–µ—Ä–∞—Ü–∏—é –Ω–∞¬†–æ—Å–Ω–æ–≤–µ <code>itertools.islice()</code></p>
<p>–†–µ–∫–æ–º–µ–Ω–¥—É—é!</p>
<p><a href=https://replit.com/@antonz/page-iterator#main.py>–ø–µ—Å–æ—á–Ω–∏—Ü–∞</a></p>
<div class=row>
<div class="col-xs-12 col-sm-10 col-md-8"><p><em>–ü–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å –Ω–∞¬†–∫–∞–Ω–∞–ª <span class=nowrap><i class="fas fa-kiwi-bird"></i> ¬´<a href=https://t.me/ohmypy><strong>Oh My Py</strong></a>¬ª</span>, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ¬†—á–∏—Å—Ç–æ–º –∫–æ–¥–µ –Ω–∞¬†Python</em></p></div>
</div>
</div>
</div><footer class=post__footer>
<div class=row>
<div class=col-xs-12>
<div class=post__date>
<time datetime="2022-05-02 13:00:00 +0000 UTC">02.05.2022</time>
</div>
<div class=post__tags>
<a href=https://antonz.ru/tags/development/>—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞</a>&nbsp;
<a href=https://antonz.ru/tags/ohmypy/>ohmypy</a>&nbsp;
</div>
</div>
</div>
</footer></article>
<aside class=post__related>
<div class="post__nav article">
<div class=row>
<div class="col-xs-12 col-sm-6">
<p>&larr;&nbsp;<a href=https://antonz.ru/sqlite-multiline/>–ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ SQLite</a></p>
</div>
</div>
</div>
<div class=article>
<div class=row>
<div class="col-xs-12 col-sm-8 col-md-6">
<h3>–ï—â—ë –ø–æ —Ç–µ–º–µ</h3>
<p><a href=/list-internals/>–ö–∞–∫ –Ω–∞¬†—Å–∞–º–æ–º –¥–µ–ª–µ —É—Å—Ç—Ä–æ–µ–Ω —Å–ø–∏—Å–æ–∫ –≤¬†Python</a></p>
<p><a href=/python-plus-one/>–í—Ç–æ—Ä–æ–π —è–∑—ã–∫ –¥–ª—è –ø–∏—Ç–æ–Ω–∏—Å—Ç–∞</a></p>
<p><a href=/simple-made-easy/>–ü—Ä–æ—Å—Ç–æ–µ –ø—Ä–æ—Ç–∏–≤ –ª–µ–≥–∫–æ–≥–æ</a></p>
</div>
</div>
</div>
</aside>
<script src=https://utteranc.es/client.js repo=nalgeon/comments.antonz.ru issue-term=pathname theme=github-light crossorigin=anonymous async></script></div>
</div>
<footer class="container footer">
<ul class=naked-list>
<li class=footer__item>–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è:
<a href=https://twitter.com/nalgeon class=footer__social-link><i class="fab fa-twitter"></i><span>–¢–≤–∏—Ç—Ç–µ—Ä</span></a>
<a href=/index.xml class=footer__social-link><i class="fas fa-rss"></i><span>RSS</span></a>
</li>
<li class=footer__item>–ü–æ—á—Ç–∞: <a href=mailto:m@antonz.ru>m@antonz.ru</a></li>
</ul>
</footer>
<script async src=//gc.zgo.at/count.js data-goatcounter=https://antonzru.goatcounter.com/count></script></body>
</html>